<mat-toolbar color="primary">
  GitHub Issue Manager
  <span class="spacer"></span>
  <a href="https://github.com/deer-inc/GitHub-Issue-Manager" mat-button target="_blank" class="github">
    <img src="/assets/github.svg" alt="">
    GitHub
  </a>
</mat-toolbar>

<main class="container">
  <div *ngIf="tokenField.valid; else inputToken">
    <form [formGroup]="form">
      <mat-form-field>
        <mat-label>リポジトリオーナー</mat-label>
        <input
          matInput
          formControlName="owner"
          type="text"
          autocomplete="off"
          required
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>リポジト名</mat-label>
        <input
          matInput
          formControlName="repo"
          type="text"
          autocomplete="off"
          required
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>マイルストーン</mat-label>
        <input
          matInput
          formControlName="milestone"
          type="text"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>ステータス</mat-label>
        <mat-select formControlName="state">
          <mat-option [value]="state" *ngFor="let state of ['open', 'closed', 'all']">
            {{ state }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <mat-label>アサイン</mat-label>
        <input
          matInput
          formControlName="assignee"
          type="text"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>作成者</mat-label>
        <input
          matInput
          formControlName="creator"
          type="text"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>メンション</mat-label>
        <input
          matInput
          formControlName="mentioned"
          type="text"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>ラベル</mat-label>
        <input
          matInput
          formControlName="labels"
          type="text"
          autocomplete="off"
        />
        <mat-hint>,（コンマ）区切りで指定</mat-hint>
      </mat-form-field>
      <mat-form-field>
        <mat-label>ソート</mat-label>
        <mat-select formControlName="sort">
          <mat-option [value]="sort" *ngFor="let sort of ['created', 'updated', 'comments']">
            {{ sort }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <mat-label>順序</mat-label>
        <mat-select formControlName="direction">
          <mat-option [value]="direction" *ngFor="let direction of ['asc', 'desc']">
            {{ direction }}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <mat-label>最終更新日</mat-label>
        <input
          matInput
          formControlName="since"
          type="date"
          autocomplete="off"
        />
      </mat-form-field>
      <mat-form-field>
        <mat-label>取得数</mat-label>
        <input
          matInput
          formControlName="per_page"
          type="number"
          autocomplete="off"
          max="100"
        />
        <mat-hint>最大100件</mat-hint>
      </mat-form-field>
      <mat-form-field>
        <mat-label>ページ</mat-label>
        <input
          matInput
          formControlName="page"
          type="number"
          autocomplete="off"
        />
      </mat-form-field>

      <button
        [disabled]="form.invalid"
        (click)="getIssues()"
        mat-raised-button
      >
        Issue取得
      </button>
    </form>

    <app-issue-table *ngIf="issues" [issues]="issues"></app-issue-table>
  </div>

  <ng-template #inputToken>
    <div class="tutorial">
      <div class="tutorial__body">
        <h2>アクセストークンを入力してください。</h2>
        <ul>
          <li>
            アクセストークンはDBやクッキーに保存されないのでご安心ください。
          </li>
          <li>
            アクセストークンがない人は<a
              href="https://github.com/settings/tokens/new"
              target="_blank"
              >作成</a
            >してください。
            <ul>
              <li>
                作成時に<b>repo</b>のみにチェックしてください
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <figure class="tutorial__image">
        <img src="/assets/api-setting.png" alt="" />
      </figure>
    </div>

    <mat-form-field class="token-field" floatLabel="always">
      <mat-label>アクセストークン</mat-label>
      <input
        type="text"
        autofocus
        required
        placeholder="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"
        maxlength="40"
        minlength="40"
        autocomplete="off"
        [formControl]="tokenField"
        (input)="initOctokit(tokenField.value)"
        matInput
      />
      <mat-error *ngIf="tokenField.invalid"
        >正しいトークンをペースしてください。</mat-error
      >
    </mat-form-field>
  </ng-template>
</main>
